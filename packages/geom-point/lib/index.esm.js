import{__spreadArrays as e,__assign as t}from"tslib";import n,{useMemo as r,useState as o,useEffect as i}from"react";import{Circle as l}from"@visx/shape";import{scaleSqrt as a,scaleOrdinal as u}from"@visx/scale";import{extent as c}from"d3-array";import"d3-time-format";import{schemeTableau10 as m}from"d3-scale-chromatic";import{useRecoilValue as f,useRecoilState as d}from"recoil";import{aesState as s,layoutState as p,labelsState as y,TooltipContainer as g,tooltipState as v,XTooltip as x,YTooltip as E,dataState as k,themeState as h,scalesState as z}from"@graphique/gg";import{voronoi as b,VoronoiPolygon as O}from"@visx/voronoi";var F=e([m[0],m[1],m[4],m[2],m[3]],m.slice(5)),S=function(e){var t=e.data,o=e.x,i=e.y,l=e.onMouseOver,a=e.onMouseLeave,u=e.onClick,c=f(s),m=f(p),d=m.width,y=m.height,g=m.margin,v=r((function(){return b({x:function(e){return o(c.x(e))},y:function(e){return i(c.y(e))},width:d,height:y}).extent([[g.left,g.top],[d-g.right,y-g.bottom-g.top]])}),[c,d,y,o,i,g])(t).polygons();return n.createElement("g",{onMouseLeave:a?function(e){return a()}:void 0},v.map((function(e,t){return n.createElement(O,{key:"voronoi-polygon-"+t,polygon:e,fill:"transparent",style:{cursor:u?"pointer":"default"},onMouseOver:l?function(n){l({d:e.data,i:t})}:void 0,onClick:u?function(n){return u({d:e.data,i:t})}:void 0})})))},_=function(e){var t=e.data,r=f(y),o=r.x,i=r.y,l=f(s),a=l.x,u=l.y;return t&&n.createElement(g,null,t.map((function(e){return n.createElement("div",{key:"group-tooltip-"+(e.label||e.group)},n.createElement("div",{style:{marginTop:4,marginBottom:4}},(e.label||"__group"!==e.group)&&n.createElement(n.Fragment,null,e.mark,n.createElement("div",{style:{display:"flex",alignItems:"flex-end",fontWeight:500}},n.createElement("div",{style:{marginBottom:4}},n.createElement("span",null,e.label||e.group," ")))),n.createElement("div",{style:{display:"flex",marginBottom:2}},n.createElement("div",null,o||a.toString(),":"),n.createElement("div",{style:{marginLeft:2,fontWeight:500,fontSize:13}},e.formattedX)),n.createElement("div",{style:{display:"flex"}},n.createElement("div",null,i||u.toString(),":"),n.createElement("div",{style:{marginLeft:2,fontWeight:500,fontSize:13}},e.formattedY))))})))},M=function(e){var t=e.scales,r=e.group,o=e.datum,i=f(v),l=i.position,a=i.content,u=i.yFormat,c=i.xFormat,m=i.xAxis,d=f(s),y=f(p),k=y.id,h=y.height,z=y.margin,b=t.x,O=t.y,F={given:d.label&&d.label(o),keyed:d.key&&d.key(o),default:null==o?void 0:o._id},S=[{x:d.x&&b(d.x(o)),y:d.y&&O(d.y(o)),formattedX:d.x&&(c?c(d.x(o)):d.x(o)),formattedY:d.y&&(u?u(d.y(o)):d.y(o)),group:r(o),label:F.given===F.default?F.keyed:F.given,datum:o}];return n.createElement(n.Fragment,null,m&&n.createElement(x,{id:k,left:S[0].x,top:-z.bottom-5,value:"boolean"==typeof m?n.createElement(g,null,c?c(d.x(o)):d.x(o)):m({x:d.x(o)})}),n.createElement(E,{id:k,left:S[0].x,top:"data"===l?-(h-S[0].y):-h,value:a?a({data:S}):n.createElement(_,{data:S})}))},L=function(e){var m=e.data,p=e.stroke,y=e.strokeWidth,g=e.fill,v=e.opacity,x=void 0===v?1:v,E=e.strokeOpacity,b=e.size,O=e.scales,_=e.hideTooltip,L=void 0!==_&&_,W=e.focused,w=e.focusedStyle,B=e.unfocusedStyle,C=e.onFocus,A=e.onFocusSelection,T=e.onExit,X=f(k),Y=m||X,q=f(s),G=f(h).defaultFill,I=d(z),N=I[0],P=I[1],j=r((function(){return N}),[N]),D=j.fill,H=j.stroke,J=j.size,K=j.groups,Q=O.x,R=O.y,U=r((function(){return q.group||q.fill||q.stroke||q.size||function(e){return"__group"}}),[q]),V=U?Array.from(new Set(X.map(U))).map((function(e){return null===e?"[null]":e})).sort():["__group"],Z=r((function(){return a({domain:q.size&&c(Y,q.size),range:(null==J?void 0:J.range)||[3,30]})}),[Y,q.size,J]),$=r((function(){return function(e){return Z&&q.size?Z(q.size(e)):b}}),[Z,q,b]),ee=r((function(){return p?[p]:(null==H?void 0:H.scale)||u({domain:V,range:(null==H?void 0:H.scheme)||(p?[p]:F)})}),[V,H,p]),te=r((function(){return function(e){return p||(ee&&q.stroke?ee(q.stroke(e)):void 0)}}),[q,ee,p]),ne=r((function(){return g?[g]:(null==D?void 0:D.scale)||u({domain:V,range:(null==D?void 0:D.scheme)||(g?[g]:F)})}),[V,D,g]),re=r((function(){return function(e){return g||(ne&&q.fill?ne(q.fill(e)):G)}}),[q,ne,g,G]),oe=o(W||[]),ie=oe[0],le=oe[1];i((function(){le(W||[])}),[W]),i((function(){K||P((function(e){return t(t({},e),{groups:V})}))}),[P,V,K]);var ae=o({x:0,y:0})[0],ue=r((function(){return ie.length||ae.x>3}),[ie,ae]),ce=t({fillOpacity:1,strokeOpacity:1},w),me=t({fillOpacity:.15,strokeOpacity:.15},B);return Y?n.createElement(n.Fragment,null,n.createElement("g",null,Y.map((function(e,r){var o=q.key&&ie.map(q.key).includes(q.key(e));return q.x(e)&&q.y(e)?n.createElement(l,{style:ue?t({},o?ce:me):{pointerEvents:"none"},key:"point-"+r,fill:re(e),fillOpacity:x,strokeOpacity:E,stroke:te(e),strokeWidth:y,r:b||(q.size?$(e):2.5),cx:Q(q.x(e)),cy:R(q.y(e))}):null}))),!L&&n.createElement(n.Fragment,null,n.createElement(S,{data:Y,x:Q,y:R,onMouseOver:function(e){var t=e.d;e.i;le([t]),C&&C({data:t})},onClick:A?function(e){var t=e.d;e.i;A({data:t})}:void 0,onMouseLeave:function(){le([]),T&&T()}}),ie&&ie[0]&&n.createElement(M,{group:U,datum:ie[0],scales:O}))):null};L.displayName="GeomPoint";export{L as GeomPoint};
//# sourceMappingURL=index.esm.js.map
