import{__spreadArrays as t,__assign as e,__rest as n}from"tslib";import i,{useMemo as o,useEffect as l,cloneElement as r,useState as a,useCallback as u,useLayoutEffect as d}from"react";import m from"react-flatten-children";import{scaleTime as c,scaleLinear as f,scaleBand as s}from"@visx/scale";import{extent as v}from"d3-array";import{timeFormat as p}from"d3-time-format";import{schemeTableau10 as y}from"d3-scale-chromatic";import{AxisBottom as x,AxisLeft as h}from"@visx/axis";import{Grid as g}from"@visx/grid";import{useSetRecoilState as k,useRecoilState as S,useRecoilValue as b,RecoilRoot as E,atom as C}from"recoil";import F from"react-resize-detector";import{createPortal as L}from"react-dom";import{Bar as w}from"@visx/shape";import{localPoint as A}from"@visx/event";var T=function(t){return"[object Date]"===Object.prototype.toString.call(t)},N=function(t,e){return void 0===e&&(e="%b %d, %Y"),p(e)(t)},I=t([y[0],y[1],y[4],y[2],y[3]],y.slice(5)),M=function(t){var a,u,d,p,y,E,C,F,L,w,A,N,I=t.data,M=t.aes,B=t.width,P=t.height,R=t.margin,W=t.parentWidth,_=t.useParentWidth,z=void 0!==_&&_,Y=(t.onMouseOver,t.onMouseOut,t.id),X=t.children,O=k(D),V=k(H),G=S(q),K=G[0],Q=G[1],Z=o((function(){return M.key?I:I.map((function(t,n){return e(e({},t),{key:n})}))}),[I,M]);l((function(){return O(Z)}),[O,Z]),l((function(){V((function(t){return e(e({},t),M)}))}),[V,M]);var $=b(U),tt=b(J),et=tt.font,nt=tt.grid,it=tt.axis,ot=tt.axisX,lt=tt.axisY,rt=tt.titleColor,at=b(j);l((function(){Q((function(t){return{width:z?W:B||t.width,height:P||t.height,margin:R?e(e({},t.margin),R):t.margin,parentWidth:W||t.parentWidth,id:Y}}))}),[Q,B,P,R,z,W,Y]);var ut,dt=K.height,mt=K.margin;ut=z?K.parentWidth:K.width;var ct,ft=[],st=[];m(X).forEach((function(t){var e,n,i=null===(n=null===(e=t)||void 0===e?void 0:e.type)||void 0===n?void 0:n.displayName;i&&i.includes("Geom")?ft.push(t):st.push(t)}));var vt,pt=I.map(M.x).find((function(t){return null!=t}));if(T(pt))ct=c({range:[mt.left,ut-mt.right],domain:(null===(a=null==at?void 0:at.x)||void 0===a?void 0:a.domain)||v(I,M.x)||[0,1]});else if(pt&&"number"!=typeof pt)"string"==typeof pt&&(ct=s({range:[mt.left,ut-mt.right],domain:(null===(p=null==at?void 0:at.x)||void 0===p?void 0:p.domain)||I.map(M.x),padding:.4}));else{var yt=(null===(u=null==at?void 0:at.x)||void 0===u?void 0:u.type)||f;ct=yt({range:[mt.left,ut-mt.right],domain:(null===(d=null==at?void 0:at.x)||void 0===d?void 0:d.domain)||v(I,M.x)})}if(M.y){var xt=I.map(M.y).find((function(t){return null!=t}));xt&&"number"!=typeof xt?"string"==typeof xt&&(vt=s({range:[mt.bottom,dt-mt.top-mt.bottom],domain:(null===(E=null==at?void 0:at.y)||void 0===E?void 0:E.domain)||I.map(M.y),padding:.2})):vt=f({range:[dt-mt.top-mt.bottom,mt.bottom],domain:(null===(y=null==at?void 0:at.y)||void 0===y?void 0:y.domain)||v(I,M.y)||[0,1],nice:!0})}else vt=f({range:[dt-mt.top-mt.bottom,mt.bottom],domain:(null===(C=null==at?void 0:at.y)||void 0===C?void 0:C.domain)||[0,1]});return ut>0?i.createElement("div",{style:{position:"relative"}},i.createElement("div",{style:{marginBottom:4,color:rt,fontFamily:null==et?void 0:et.family}},null==$?void 0:$.title),i.createElement("div",{style:{marginLeft:8,marginBottom:2,fontSize:11.5,fontFamily:null==et?void 0:et.family,lineHeight:1.2,color:(null==it?void 0:it.labelColor)||(null==lt?void 0:lt.labelColor),minHeight:20,fontWeight:600}},null==$?void 0:$.y),i.createElement("svg",{width:ut,height:dt},i.createElement("g",null,I.length&&i.createElement(g,{top:0,left:mt.left,xScale:ct,yScale:vt,stroke:(null==nt?void 0:nt.stroke)?null==nt?void 0:nt.stroke:"transparent",width:ut-mt.left-mt.right,height:dt-mt.bottom,numTicksRows:(null===(F=null==at?void 0:at.y)||void 0===F?void 0:F.numTicks)||(dt>500?5:dt>220?4:2),numTicksColumns:0}),i.createElement(i.Fragment,null,i.createElement("g",null,i.createElement(x,{top:dt-mt.top-mt.bottom,left:0,scale:ct,hideAxisLine:ot?void 0!==(null==ot?void 0:ot.hideAxisLine)?ot.hideAxisLine:void 0:null==it?void 0:it.hideAxisLines,stroke:(null==ot?void 0:ot.stroke)||(null==it?void 0:it.stroke),numTicks:(null===(L=null==at?void 0:at.x)||void 0===L?void 0:L.numTicks)||ut>500?4:ut>200?2:ut>100?1:0,tickStroke:(null==nt?void 0:nt.stroke)||(null==ot?void 0:ot.tickStroke)||(null==it?void 0:it.tickStroke),tickLength:(null==nt?void 0:nt.stroke)?dt:8,tickTransform:"translate(0, "+((null==nt?void 0:nt.stroke)?-(dt-2):0)+")",tickFormat:(null===(w=null==at?void 0:at.x)||void 0===w?void 0:w.format)?function(t){return at.x.format(t)}:void 0,tickLabelProps:function(){return{fill:(null==it?void 0:it.tickLabelColor)||(null==ot?void 0:ot.tickLabelColor),textAnchor:"middle",fontSize:11,fontFamily:null==et?void 0:et.family,dy:"0.25em"}},tickComponent:function(t){var o=t.formattedValue,l=n(t,["formattedValue"]);return i.createElement("text",e({},l),o)}}),i.createElement("g",null,i.createElement("text",{style:{transform:"translate("+(mt.left+2)+"px, "+(dt-4)+"px)",pointerEvents:"none",fontFamily:null==et?void 0:et.family,fontSize:11.5,fill:(null==it?void 0:it.labelColor)||(null==ot?void 0:ot.labelColor),fontWeight:600}},null==$?void 0:$.x))),i.createElement("g",null,i.createElement(h,{top:0,left:mt.left,scale:vt,numTicks:(null===(A=null==at?void 0:at.y)||void 0===A?void 0:A.numTicks)||(dt>500?5:dt>220?4:2),hideAxisLine:lt?void 0!==(null==lt?void 0:lt.hideAxisLine)?lt.hideAxisLine:void 0:null==it?void 0:it.hideAxisLines,stroke:(null==lt?void 0:lt.stroke)||(null==it?void 0:it.stroke),tickStroke:(null==lt?void 0:lt.tickStroke)||(null==it?void 0:it.tickStroke),tickFormat:(null===(N=null==at?void 0:at.y)||void 0===N?void 0:N.format)?function(t){return at.y.format(t)}:void 0,tickLabelProps:function(){return{fill:(null==it?void 0:it.tickLabelColor)||(null==lt?void 0:lt.tickLabelColor),textAnchor:"end",fontSize:11,fontFamily:null==et?void 0:et.family,dx:"-0.25em",dy:"0.25em"}},tickComponent:function(t){var o=t.formattedValue,l=n(t,["formattedValue"]);return i.createElement("text",e({},l),o)}})))),i.createElement("g",null,ft.map((function(t,e){return r(t,{key:"geom-"+e,scales:{x:ct,y:vt},id:Y})})))),i.createElement("div",{style:{position:"relative"}},i.createElement("div",{id:"__gg-tooltip-x-"+Y}),i.createElement("div",{id:"__gg-tooltip-y-"+Y})),i.createElement("div",{style:{position:"absolute",bottom:0,width:"100%",height:dt,pointerEvents:"none"}},st)):null},B=function(t){var l=t.children,r=n(t,["children"]),a=o((function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(t){return(+t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+t/4).toString(16)}))}),[]);return i.createElement(E,null,i.createElement(F,{refreshMode:"debounce",refreshRate:50},(function(t){var n=t.width,o=t.targetRef;return i.createElement("div",{ref:o},i.createElement(M,e({},r,{parentWidth:n,id:a}),l))})))},P=function(t){var e=t.title,n=t.x,i=t.y,o=t.legend,r=t.tooltip,a=k(U);return l((function(){a({title:e,x:n,y:i,legend:o,tooltip:r})}),[a,e,n,i,o,r]),null};P.displayName="Labels";var R=function(t){var n=t.titleColor,i=t.markerStroke,o=t.defaultStroke,r=t.defaultFill,a=t.font,u=t.grid,d=t.axis,m=t.axisX,c=t.axisY,f=k(J);return l((function(){f((function(t){return{titleColor:n||t.titleColor,markerStroke:i||t.markerStroke,defaultStroke:o||t.defaultStroke,defaultFill:r||t.defaultFill,font:a?e(e({},t.font),a):t.font,grid:u?e(e({},t.grid),u):t.grid,axis:d?e(e({},t.axis),d):t.axis,axisX:m?e(e({},t.axisX),m):t.axisX,axisY:c?e(e({},t.axisY),c):t.axisY}}))}),[f,n,i,o,r,a,u,d,m,c]),null};R.displayName="Theme";var W=function(t){var e=t.children,n=t.id,i=document.getElementById("__gg-tooltip-x-"+n);return i?L(e,i):null},_=function(t){var e=t.children,n=t.id,i=document.getElementById("__gg-tooltip-y-"+n);return i?L(e,i):null},z=function(t){var e=t.id,n=t.left,o=t.top,r=t.value,u=b(q).width,d=b(J).font,m=b(G).keepInParent,c=a(0),f=c[0],s=c[1];return l((function(){var t=document.getElementById("x-container-"+e),i=null==t?void 0:t.getBoundingClientRect(),o=null==i?void 0:i.width,l=o&&n-o/2,r=l&&o&&l+o;m&&l&&l<2?l=2:m&&l&&o&&r&&r>u&&(l=u-o-2),l&&s(l)}),[u,n,e,m]),i.createElement(W,{id:e},i.createElement("div",{id:"x-container-"+e,style:{fontFamily:null==d?void 0:d.family,pointerEvents:"none",position:"absolute",left:f,top:o,whiteSpace:"nowrap"}},r))},Y=function(t){var e=t.id,n=t.left,o=t.top,l=t.value,r=b(q).width,m=b(G),c=m.position,f=m.keepInParent,s=b(J).font,v=a(0),p=v[0],y=v[1],x=a(0),h=x[0],g=x[1],k=u((function(t){null!==t&&(y(t.getBoundingClientRect().height),g(t.getBoundingClientRect().width))}),[n]),S=a(void 0),E=S[0],C=S[1],F=a(void 0),L=F[0],w=F[1];return d((function(){var t=n+8;f&&t&&t<2?t=2:f&&n>r/2&&(t=n-h-8),C(t)}),[f,r,h,n]),d((function(){w(o-("data"===c?p/2:0)-4)}),[c,p,o]),i.createElement(_,{id:e},i.createElement("div",{ref:k,style:{fontFamily:null==s?void 0:s.family,left:E,top:L,pointerEvents:"none",position:"absolute",whiteSpace:"nowrap"}},l))},X=function(t){var e=t.x0,n=t.y0,i=t.position,o=t.keepInParent,r=t.xAxis,a=t.content,u=t.yFormat,d=t.xFormat,m=t.datum,c=k(G);return l((function(){c((function(t){return{x0:e,y0:n,position:i||t.position,keepInParent:void 0!==o?o:t.keepInParent,xAxis:r||t.xAxis,content:a||t.content,yFormat:u||t.yFormat,xFormat:d||t.xFormat,datum:m}}))}),[c,e,n,i,o,r,a,u,d,m]),null},O={fontSize:12,padding:"4px 6px 4px 6px",background:"#fefefee1",border:"1px solid #eee",borderRadius:2,boxShadow:"rgba(0, 0, 0, 0.5) 0px 1px 4px"},V=function(t){var n=t.children,o=t.style;return i.createElement("div",{style:e(e({},O),o)},n)};X.displayName="Tooltip";var D=C({key:"dataState",default:[]}),H=C({key:"aesState",default:{label:function(t){return t._id}}}),U=C({key:"labelsState",default:{title:"",x:"",y:""}}),j=C({key:"scalesState",default:{scheme:I}}),G=C({key:"tooltipState",default:{position:"data",keepInParent:!0,xFormat:function(t){return T(t)?N(t):"number"==typeof t?t.toLocaleString(void 0,{maximumFractionDigits:2}):t.toString()},yFormat:function(t){return T(t)?N(t):"number"==typeof t?t.toLocaleString(void 0,{maximumFractionDigits:2}):t.toString()},xAxis:!1}}),q=C({key:"layoutState",default:{parentWidth:0,width:550,height:300,margin:{top:8,right:20,bottom:35,left:50}}}),J=C({key:"themeState",default:{titleColor:"#222",markerStroke:"#fff",defaultStroke:"cornflowerblue",defaultFill:"#777777ee",font:{family:"-apple-system, BlinkMacSystemFont, Segoe UI,\n               Roboto, Oxygen-Sans, Ubuntu, Cantarell,\n               Helvetica Neue, sans-serif"},grid:{stroke:"#55555513"},axis:{labelColor:"#666",stroke:"#55555533",tickLabelColor:"#888",tickStroke:"#55555513",hideAxisLines:!0},axisX:{labelColor:"#666",stroke:"#55555533",tickLabelColor:"#888",tickStroke:"#55555513",hideAxisLine:!0},axisY:{labelColor:"#666",stroke:"#55555533",tickLabelColor:"#888",tickStroke:"#55555513",hideAxisLine:!0}}}),K=function(t){var n=t.xScale,o=t.yScale,l=t.onMouseOver,r=t.onMouseOut,a=k(G),d=b(q),m=d.margin,c=d.width,f=d.height,s=u((function(t){var i=A(t),r=n.invert(null==i?void 0:i.x),u=o.invert(null==i?void 0:i.y);a((function(t){return e(e({},t),{x0:r,y0:u})})),l&&l({x0:r,y0:u})}),[a,n,o,l]),v=function(){a((function(t){return e(e({},t),{x0:void 0,y0:void 0})})),r&&r()};return i.createElement(w,{x:m.left,y:m.top,width:c-m.left-m.right,height:f-m.top-m.bottom-8,fill:"transparent",onMouseMove:s,onMouseLeave:v,onTouchStart:s,onTouchMove:s,onTouchEnd:v})};K.displayName="ScaleStroke";var Q=function(t){var n=t.scheme,i=void 0===n?I:n,o=t.reverse,r=void 0!==o&&o,a=k(j);return l((function(){a((function(t){return e(e({},t),{stroke:{scheme:i,reverse:r}})}))}),[a,i,r]),null};Q.displayName="ScaleStroke";var Z=function(t){var n=t.scheme,i=t.reverse,o=void 0!==i&&i,r=k(j);return l((function(){r((function(t){return e(e({},t),{fill:{scheme:n,reverse:o}})}))}),[r,n,o]),null};Z.displayName="ScaleFill";var $=function(t){var n=t.type,i=t.format,o=t.numTicks,r=t.domain,a=k(j);return l((function(){a((function(t){return e(e({},t),{x:e(e({},t.x),{type:n,format:i,numTicks:o,domain:r})})}))}),[a,n,i,o,r]),null};$.displayName="ScaleX";var tt=function(t){var n=t.type,i=t.format,o=t.numTicks,r=t.domain,a=k(j);return l((function(){a((function(t){return e(e({},t),{y:{type:n,format:i,numTicks:o,domain:r}})}))}),[a,n,i,o,r]),null};tt.displayName="ScaleY";var et=function(t){var n=t.values,i=t.range,o=k(j);return l((function(){o((function(t){return e(e({},t),{size:{values:n,range:i}})}))}),[o,n,i]),null};et.displayName="ScaleSize";var nt=function(t){var n=t.values,i=k(j);return l((function(){i((function(t){return e(e({},t),{dashArray:{values:n}})}))}),[i,n]),null};nt.displayName="ScaleDashArray";export{K as EventField,B as GG,P as Labels,nt as ScaleDashArray,Z as ScaleFill,et as ScaleSize,Q as ScaleStroke,$ as ScaleX,tt as ScaleY,R as Theme,X as Tooltip,V as TooltipContainer,z as XTooltip,Y as YTooltip,H as aesState,D as dataState,U as labelsState,q as layoutState,j as scalesState,J as themeState,G as tooltipState};
//# sourceMappingURL=index.esm.js.map
