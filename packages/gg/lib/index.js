"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),i=require("react-flatten-children"),n=require("@visx/scale"),o=require("d3-array"),l=require("d3-time-format"),a=require("d3-scale-chromatic"),r=require("@visx/axis"),u=require("@visx/grid"),s=require("recoil"),d=require("react-resize-detector"),c=require("react-dom"),f=require("@visx/shape"),m=require("@visx/event");function v(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=v(t),g=v(i),x=v(d),y=function(e){return"[object Date]"===Object.prototype.toString.call(e)},h=function(e,t){return void 0===t&&(t="%b %d, %Y"),l.timeFormat(t)(e)},S=e.__spreadArrays([a.schemeTableau10[0],a.schemeTableau10[1],a.schemeTableau10[4],a.schemeTableau10[2],a.schemeTableau10[3]],a.schemeTableau10.slice(5)),_=function(i){var l,a,d,c,f,m,v,x,h,S,_,k,b=i.data,E=i.aes,R=i.width,L=i.height,C=i.margin,V=i.parentWidth,M=i.useParentWidth,P=void 0!==M&&M,N=(i.onMouseOver,i.onMouseOut,i.id),I=i.children,Y=s.useSetRecoilState(F),z=s.useSetRecoilState(T),W=s.useRecoilState(q),X=W[0],O=W[1],D=t.useMemo((function(){return E.key?b:b.map((function(t,i){return e.__assign(e.__assign({},t),{key:i})}))}),[b,E]);t.useEffect((function(){return Y(D)}),[Y,D]),t.useEffect((function(){z((function(t){return e.__assign(e.__assign({},t),E)}))}),[z,E]);var j=s.useRecoilValue(A),G=s.useRecoilValue(B),H=G.font,U=G.grid,J=G.axis,K=G.axisX,Q=G.axisY,Z=G.titleColor,$=s.useRecoilValue(w);t.useEffect((function(){O((function(t){return{width:P?V:R||t.width,height:L||t.height,margin:C?e.__assign(e.__assign({},t.margin),C):t.margin,parentWidth:V||t.parentWidth,id:N}}))}),[O,R,L,C,P,V,N]);var ee,te=X.height,ie=X.margin;ee=P?X.parentWidth:X.width;var ne,oe=[],le=[];g.default(I).forEach((function(e){var t,i,n=null===(i=null===(t=e)||void 0===t?void 0:t.type)||void 0===i?void 0:i.displayName;n&&n.includes("Geom")?oe.push(e):le.push(e)}));var ae,re=b.map(E.x).find((function(e){return null!=e}));if(y(re))ne=n.scaleTime({range:[ie.left,ee-ie.right],domain:(null===(l=null==$?void 0:$.x)||void 0===l?void 0:l.domain)||o.extent(b,E.x)||[0,1]});else if(re&&"number"!=typeof re)"string"==typeof re&&(ne=n.scaleBand({range:[ie.left,ee-ie.right],domain:(null===(c=null==$?void 0:$.x)||void 0===c?void 0:c.domain)||b.map(E.x),padding:.4}));else{var ue=(null===(a=null==$?void 0:$.x)||void 0===a?void 0:a.type)||n.scaleLinear;ne=ue({range:[ie.left,ee-ie.right],domain:(null===(d=null==$?void 0:$.x)||void 0===d?void 0:d.domain)||o.extent(b,E.x)})}if(E.y){var se=b.map(E.y).find((function(e){return null!=e}));se&&"number"!=typeof se?"string"==typeof se&&(ae=n.scaleBand({range:[ie.bottom,te-ie.top-ie.bottom],domain:(null===(m=null==$?void 0:$.y)||void 0===m?void 0:m.domain)||b.map(E.y),padding:.2})):ae=n.scaleLinear({range:[te-ie.top-ie.bottom,ie.bottom],domain:(null===(f=null==$?void 0:$.y)||void 0===f?void 0:f.domain)||o.extent(b,E.y)||[0,1],nice:!0})}else ae=n.scaleLinear({range:[te-ie.top-ie.bottom,ie.bottom],domain:(null===(v=null==$?void 0:$.y)||void 0===v?void 0:v.domain)||[0,1]});return ee>0?p.default.createElement("div",{style:{position:"relative"}},p.default.createElement("div",{style:{marginBottom:4,color:Z,fontFamily:null==H?void 0:H.family}},null==j?void 0:j.title),p.default.createElement("div",{style:{marginLeft:8,marginBottom:2,fontSize:11.5,fontFamily:null==H?void 0:H.family,lineHeight:1.2,color:(null==J?void 0:J.labelColor)||(null==Q?void 0:Q.labelColor),minHeight:20,fontWeight:600}},null==j?void 0:j.y),p.default.createElement("svg",{width:ee,height:te},p.default.createElement("g",null,b.length&&p.default.createElement(u.Grid,{top:0,left:ie.left,xScale:ne,yScale:ae,stroke:(null==U?void 0:U.stroke)?null==U?void 0:U.stroke:"transparent",width:ee-ie.left-ie.right,height:te-ie.bottom,numTicksRows:(null===(x=null==$?void 0:$.y)||void 0===x?void 0:x.numTicks)||(te>500?5:te>220?4:2),numTicksColumns:0}),p.default.createElement(p.default.Fragment,null,p.default.createElement("g",null,p.default.createElement(r.AxisBottom,{top:te-ie.top-ie.bottom,left:0,scale:ne,hideAxisLine:K?void 0!==(null==K?void 0:K.hideAxisLine)?K.hideAxisLine:void 0:null==J?void 0:J.hideAxisLines,stroke:(null==K?void 0:K.stroke)||(null==J?void 0:J.stroke),numTicks:(null===(h=null==$?void 0:$.x)||void 0===h?void 0:h.numTicks)||ee>500?4:ee>200?2:ee>100?1:0,tickStroke:(null==U?void 0:U.stroke)||(null==K?void 0:K.tickStroke)||(null==J?void 0:J.tickStroke),tickLength:(null==U?void 0:U.stroke)?te:8,tickTransform:"translate(0, "+((null==U?void 0:U.stroke)?-(te-2):0)+")",tickFormat:(null===(S=null==$?void 0:$.x)||void 0===S?void 0:S.format)?function(e){return $.x.format(e)}:void 0,tickLabelProps:function(){return{fill:(null==J?void 0:J.tickLabelColor)||(null==K?void 0:K.tickLabelColor),textAnchor:"middle",fontSize:11,fontFamily:null==H?void 0:H.family,dy:"0.25em"}},tickComponent:function(t){var i=t.formattedValue,n=e.__rest(t,["formattedValue"]);return p.default.createElement("text",e.__assign({},n),i)}}),p.default.createElement("g",null,p.default.createElement("text",{style:{transform:"translate("+(ie.left+2)+"px, "+(te-4)+"px)",pointerEvents:"none",fontFamily:null==H?void 0:H.family,fontSize:11.5,fill:(null==J?void 0:J.labelColor)||(null==K?void 0:K.labelColor),fontWeight:600}},null==j?void 0:j.x))),p.default.createElement("g",null,p.default.createElement(r.AxisLeft,{top:0,left:ie.left,scale:ae,numTicks:(null===(_=null==$?void 0:$.y)||void 0===_?void 0:_.numTicks)||(te>500?5:te>220?4:2),hideAxisLine:Q?void 0!==(null==Q?void 0:Q.hideAxisLine)?Q.hideAxisLine:void 0:null==J?void 0:J.hideAxisLines,stroke:(null==Q?void 0:Q.stroke)||(null==J?void 0:J.stroke),tickStroke:(null==Q?void 0:Q.tickStroke)||(null==J?void 0:J.tickStroke),tickFormat:(null===(k=null==$?void 0:$.y)||void 0===k?void 0:k.format)?function(e){return $.y.format(e)}:void 0,tickLabelProps:function(){return{fill:(null==J?void 0:J.tickLabelColor)||(null==Q?void 0:Q.tickLabelColor),textAnchor:"end",fontSize:11,fontFamily:null==H?void 0:H.family,dx:"-0.25em",dy:"0.25em"}},tickComponent:function(t){var i=t.formattedValue,n=e.__rest(t,["formattedValue"]);return p.default.createElement("text",e.__assign({},n),i)}})))),p.default.createElement("g",null,oe.map((function(e,i){return t.cloneElement(e,{key:"geom-"+i,scales:{x:ne,y:ae},id:N})})))),p.default.createElement("div",{style:{position:"relative"}},p.default.createElement("div",{id:"__gg-tooltip-x-"+N}),p.default.createElement("div",{id:"__gg-tooltip-y-"+N})),p.default.createElement("div",{style:{position:"absolute",bottom:0,width:"100%",height:te,pointerEvents:"none"}},le)):null},k=function(e){var i=e.title,n=e.x,o=e.y,l=e.legend,a=e.tooltip,r=s.useSetRecoilState(A);return t.useEffect((function(){r({title:i,x:n,y:o,legend:l,tooltip:a})}),[r,i,n,o,l,a]),null};k.displayName="Labels";var b=function(i){var n=i.titleColor,o=i.markerStroke,l=i.defaultStroke,a=i.defaultFill,r=i.font,u=i.grid,d=i.axis,c=i.axisX,f=i.axisY,m=s.useSetRecoilState(B);return t.useEffect((function(){m((function(t){return{titleColor:n||t.titleColor,markerStroke:o||t.markerStroke,defaultStroke:l||t.defaultStroke,defaultFill:a||t.defaultFill,font:r?e.__assign(e.__assign({},t.font),r):t.font,grid:u?e.__assign(e.__assign({},t.grid),u):t.grid,axis:d?e.__assign(e.__assign({},t.axis),d):t.axis,axisX:c?e.__assign(e.__assign({},t.axisX),c):t.axisX,axisY:f?e.__assign(e.__assign({},t.axisY),f):t.axisY}}))}),[m,n,o,l,a,r,u,d,c,f]),null};b.displayName="Theme";var E=function(e){var t=e.children,i=e.id,n=document.getElementById("__gg-tooltip-x-"+i);return n?c.createPortal(t,n):null},R=function(e){var t=e.children,i=e.id,n=document.getElementById("__gg-tooltip-y-"+i);return n?c.createPortal(t,n):null},L=function(e){var i=e.x0,n=e.y0,o=e.position,l=e.keepInParent,a=e.xAxis,r=e.content,u=e.yFormat,d=e.xFormat,c=e.datum,f=s.useSetRecoilState(V);return t.useEffect((function(){f((function(e){return{x0:i,y0:n,position:o||e.position,keepInParent:void 0!==l?l:e.keepInParent,xAxis:a||e.xAxis,content:r||e.content,yFormat:u||e.yFormat,xFormat:d||e.xFormat,datum:c}}))}),[f,i,n,o,l,a,r,u,d,c]),null},C={fontSize:12,padding:"4px 6px 4px 6px",background:"#fefefee1",border:"1px solid #eee",borderRadius:2,boxShadow:"rgba(0, 0, 0, 0.5) 0px 1px 4px"};L.displayName="Tooltip";var F=s.atom({key:"dataState",default:[]}),T=s.atom({key:"aesState",default:{label:function(e){return e._id}}}),A=s.atom({key:"labelsState",default:{title:"",x:"",y:""}}),w=s.atom({key:"scalesState",default:{scheme:S}}),V=s.atom({key:"tooltipState",default:{position:"data",keepInParent:!0,xFormat:function(e){return y(e)?h(e):"number"==typeof e?e.toLocaleString(void 0,{maximumFractionDigits:2}):e.toString()},yFormat:function(e){return y(e)?h(e):"number"==typeof e?e.toLocaleString(void 0,{maximumFractionDigits:2}):e.toString()},xAxis:!1}}),q=s.atom({key:"layoutState",default:{parentWidth:0,width:550,height:300,margin:{top:8,right:20,bottom:35,left:50}}}),B=s.atom({key:"themeState",default:{titleColor:"#222",markerStroke:"#fff",defaultStroke:"cornflowerblue",defaultFill:"#777777ee",font:{family:"-apple-system, BlinkMacSystemFont, Segoe UI,\n               Roboto, Oxygen-Sans, Ubuntu, Cantarell,\n               Helvetica Neue, sans-serif"},grid:{stroke:"#55555513"},axis:{labelColor:"#666",stroke:"#55555533",tickLabelColor:"#888",tickStroke:"#55555513",hideAxisLines:!0},axisX:{labelColor:"#666",stroke:"#55555533",tickLabelColor:"#888",tickStroke:"#55555513",hideAxisLine:!0},axisY:{labelColor:"#666",stroke:"#55555533",tickLabelColor:"#888",tickStroke:"#55555513",hideAxisLine:!0}}}),M=function(i){var n=i.xScale,o=i.yScale,l=i.onMouseOver,a=i.onMouseOut,r=s.useSetRecoilState(V),u=s.useRecoilValue(q),d=u.margin,c=u.width,v=u.height,g=t.useCallback((function(t){var i=m.localPoint(t),a=n.invert(null==i?void 0:i.x),u=o.invert(null==i?void 0:i.y);r((function(t){return e.__assign(e.__assign({},t),{x0:a,y0:u})})),l&&l({x0:a,y0:u})}),[r,n,o,l]),x=function(){r((function(t){return e.__assign(e.__assign({},t),{x0:void 0,y0:void 0})})),a&&a()};return p.default.createElement(f.Bar,{x:d.left,y:d.top,width:c-d.left-d.right,height:v-d.top-d.bottom-8,fill:"transparent",onMouseMove:g,onMouseLeave:x,onTouchStart:g,onTouchMove:g,onTouchEnd:x})};M.displayName="ScaleStroke";var P=function(i){var n=i.scheme,o=void 0===n?S:n,l=i.reverse,a=void 0!==l&&l,r=s.useSetRecoilState(w);return t.useEffect((function(){r((function(t){return e.__assign(e.__assign({},t),{stroke:{scheme:o,reverse:a}})}))}),[r,o,a]),null};P.displayName="ScaleStroke";var N=function(i){var n=i.scheme,o=i.reverse,l=void 0!==o&&o,a=s.useSetRecoilState(w);return t.useEffect((function(){a((function(t){return e.__assign(e.__assign({},t),{fill:{scheme:n,reverse:l}})}))}),[a,n,l]),null};N.displayName="ScaleFill";var I=function(i){var n=i.type,o=i.format,l=i.numTicks,a=i.domain,r=s.useSetRecoilState(w);return t.useEffect((function(){r((function(t){return e.__assign(e.__assign({},t),{x:e.__assign(e.__assign({},t.x),{type:n,format:o,numTicks:l,domain:a})})}))}),[r,n,o,l,a]),null};I.displayName="ScaleX";var Y=function(i){var n=i.type,o=i.format,l=i.numTicks,a=i.domain,r=s.useSetRecoilState(w);return t.useEffect((function(){r((function(t){return e.__assign(e.__assign({},t),{y:{type:n,format:o,numTicks:l,domain:a}})}))}),[r,n,o,l,a]),null};Y.displayName="ScaleY";var z=function(i){var n=i.values,o=i.range,l=s.useSetRecoilState(w);return t.useEffect((function(){l((function(t){return e.__assign(e.__assign({},t),{size:{values:n,range:o}})}))}),[l,n,o]),null};z.displayName="ScaleSize";var W=function(i){var n=i.values,o=s.useSetRecoilState(w);return t.useEffect((function(){o((function(t){return e.__assign(e.__assign({},t),{dashArray:{values:n}})}))}),[o,n]),null};W.displayName="ScaleDashArray",exports.EventField=M,exports.GG=function(i){var n=i.children,o=e.__rest(i,["children"]),l=t.useMemo((function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(e){return(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)}))}),[]);return p.default.createElement(s.RecoilRoot,null,p.default.createElement(x.default,{refreshMode:"debounce",refreshRate:50},(function(t){var i=t.width,a=t.targetRef;return p.default.createElement("div",{ref:a},p.default.createElement(_,e.__assign({},o,{parentWidth:i,id:l}),n))})))},exports.Labels=k,exports.ScaleDashArray=W,exports.ScaleFill=N,exports.ScaleSize=z,exports.ScaleStroke=P,exports.ScaleX=I,exports.ScaleY=Y,exports.Theme=b,exports.Tooltip=L,exports.TooltipContainer=function(t){var i=t.children,n=t.style;return p.default.createElement("div",{style:e.__assign(e.__assign({},C),n)},i)},exports.XTooltip=function(e){var i=e.id,n=e.left,o=e.top,l=e.value,a=s.useRecoilValue(q).width,r=s.useRecoilValue(B).font,u=s.useRecoilValue(V).keepInParent,d=t.useState(0),c=d[0],f=d[1];return t.useEffect((function(){var e=document.getElementById("x-container-"+i),t=null==e?void 0:e.getBoundingClientRect(),o=null==t?void 0:t.width,l=o&&n-o/2,r=l&&o&&l+o;u&&l&&l<2?l=2:u&&l&&o&&r&&r>a&&(l=a-o-2),l&&f(l)}),[a,n,i,u]),p.default.createElement(E,{id:i},p.default.createElement("div",{id:"x-container-"+i,style:{fontFamily:null==r?void 0:r.family,pointerEvents:"none",position:"absolute",left:c,top:o,whiteSpace:"nowrap"}},l))},exports.YTooltip=function(e){var i=e.id,n=e.left,o=e.top,l=e.value,a=s.useRecoilValue(q).width,r=s.useRecoilValue(V),u=r.position,d=r.keepInParent,c=s.useRecoilValue(B).font,f=t.useState(0),m=f[0],v=f[1],g=t.useState(0),x=g[0],y=g[1],h=t.useCallback((function(e){null!==e&&(v(e.getBoundingClientRect().height),y(e.getBoundingClientRect().width))}),[n]),S=t.useState(void 0),_=S[0],k=S[1],b=t.useState(void 0),E=b[0],L=b[1];return t.useLayoutEffect((function(){var e=n+8;d&&e&&e<2?e=2:d&&n>a/2&&(e=n-x-8),k(e)}),[d,a,x,n]),t.useLayoutEffect((function(){L(o-("data"===u?m/2:0)-4)}),[u,m,o]),p.default.createElement(R,{id:i},p.default.createElement("div",{ref:h,style:{fontFamily:null==c?void 0:c.family,left:_,top:E,pointerEvents:"none",position:"absolute",whiteSpace:"nowrap"}},l))},exports.aesState=T,exports.dataState=F,exports.labelsState=A,exports.layoutState=q,exports.scalesState=w,exports.themeState=B,exports.tooltipState=V;
//# sourceMappingURL=index.js.map
