"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),r=require("@visx/shape"),a=require("@visx/scale");require("d3-time-format");var n=require("d3-scale-chromatic"),l=require("@graphique/gg"),u=require("recoil"),o=require("d3-array"),i=require("react-spring");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=s(t),d=e.__spreadArrays([n.schemeTableau10[0],n.schemeTableau10[1],n.schemeTableau10[4],n.schemeTableau10[2],n.schemeTableau10[3]],n.schemeTableau10.slice(5)),f=function(e){var t=e.data,r=e.hasXAxisTooltip,a=void 0!==r&&r,n=t[0].formattedX;return t&&c.default.createElement(l.TooltipContainer,null,!a&&c.default.createElement("div",{style:{marginTop:2,marginBottom:1===t.length?2:6,color:"#555"}},n),t.map((function(e,r){return c.default.createElement("div",{key:"group-tooltip-"+(e.label||e.group)},c.default.createElement("div",{style:{marginTop:3,marginBottom:t.length<r+1?3:2,display:"flex",alignItems:"center"}},(e.label||"__group"!==e.group)&&c.default.createElement(c.default.Fragment,null,e.mark,c.default.createElement("div",{style:{display:"flex",alignItems:"flex-end",marginLeft:4}},c.default.createElement("div",{style:{marginRight:5}},c.default.createElement("span",null,e.label||e.group," ")))),c.default.createElement("div",{style:{fontWeight:500,fontSize:13}},e.formattedY)))})))},m=function(e){var t=e.left,a=e.y,n=e.markerData,o=e.markerFill,i=e.markerRadius,s=e.strokeOpacity,d=u.useRecoilValue(l.themeState).markerStroke,f=u.useRecoilValue(l.layoutState),m=f.height,p=f.margin;return c.default.createElement(c.default.Fragment,null,c.default.createElement("g",null,c.default.createElement(r.Line,{from:{x:t,y:0},to:{x:t,y:m-p.top-p.bottom},stroke:"#888",strokeWidth:1.5,style:{pointerEvents:"none"},strokeDasharray:"2,2"})),n.map((function(e,r){var l=n.find((function(t){return t.group===e.group})),u=l?a(l):void 0;return e.group&&u?c.default.createElement("g",{key:"linemarker-"+r},c.default.createElement("circle",{cx:t,cy:a(l),r:i,fill:o(e.group),fillOpacity:s||.9,stroke:d,strokeOpacity:.92,strokeWidth:i/3.2,style:{pointerEvents:"none"}})):null})))},p=function(a){var n=a.data,i=a.group,s=a.x,d=a.y,p=a.b,g=a.markerRadius,v=a.strokeOpacity,y=a.thisStrokeScale,h=a.thisSizeScale,k=a.thisDashArrayScale,E=a.stroke,S=u.useRecoilValue(l.tooltipState),x=S.x0,_=S.position,b=S.xAxis,M=S.content,O=S.yFormat,R=S.xFormat,T=u.useRecoilValue(l.layoutState),q=T.id,F=T.margin,L=T.height,A=u.useRecoilValue(l.aesState).y,D=o.bisector(p).left,V=t.useMemo((function(){return D(n,x,1)}),[n,x,D]),z=t.useMemo((function(){return n[V-1]}),[n,V]),W=t.useMemo((function(){return s(z)}),[s,z]),X=t.useMemo((function(){return z&&n.filter((function(e){return+s(e)===s(z)})).map((function(t){return e.__assign(e.__assign({},t),{group:i(t)})}))}),[n,s,z,i]),C=t.useMemo((function(){return o.mean(X.map(d))||0}),[X,d]),B=t.useMemo((function(){return p(z)}),[p,z]),I=t.useMemo((function(){return X.filter((function(e){return A(e)})).map((function(e){var t=c.default.createElement("svg",{height:8,width:24},c.default.createElement(r.Line,{from:{x:0,y:4},to:{x:24,y:4},stroke:y(i(e)),strokeWidth:h(i(e)),strokeDasharray:k(i(e))}));return{group:i(e),mark:t,x:B,y:A(e),formattedY:O?O(A(e)):A(e),formattedX:R?R(B):B.toString()}}))}),[X,i,B,A,k,y,h,O,R]);return x?c.default.createElement(c.default.Fragment,null,c.default.createElement(m,{left:W,y:d,markerData:X,markerFill:function(e){return"__group"===e?E:y(e)},markerRadius:g,strokeOpacity:v}),b&&c.default.createElement(l.XTooltip,{id:q,left:W,top:-F.bottom-5,value:"boolean"==typeof b?c.default.createElement(l.TooltipContainer,null,R?R(B):B.toString()):b({x:B})}),X.some(A)&&c.default.createElement(l.YTooltip,{id:q,left:W,top:"data"===_?-(L-C):-L,value:M?M({data:I}):c.default.createElement(f,{data:I,hasXAxisTooltip:!!b})})):null},g=function(n){var s=n.data,f=n.stroke,m=n.strokeOpacity,g=void 0===m?1:m,v=n.strokeDashArray,y=n.size,h=n.scales,k=n.id,E=n.curve,S=n.markerRadius,x=void 0===S?5:S,_=n.hideTooltip,b=void 0!==_&&_,M=n.animate,O=void 0!==M&&M,R=n.onMouseOver,T=n.onMouseOut,q=t.useMemo((function(){return h}),[h]),F=q.x,L=q.y,A=u.useRecoilValue(l.dataState),D=t.useMemo((function(){return s||A}),[s,A]),V=u.useRecoilValue(l.aesState),z=u.useRecoilValue(l.themeState).defaultStroke,W=u.useRecoilState(l.scalesState),X=W[0],C=W[1],B=t.useMemo((function(){return X}),[X]),I=B.stroke,N=B.size,Y=B.dashArray,j=B.groups,w=t.useCallback((function(e){return F&&V.x(e)?F(V.x(e)):0}),[F,V]),G=t.useCallback((function(e){return L&&V.y(e)?L(V.y(e)):void 0}),[L,V]),P=t.useMemo((function(){return V.group||V.stroke||V.size||function(e){return"__group"}}),[V]),H=t.useMemo((function(){return P?Array.from(new Set(A.map(P))).map((function(e){return null===e?"[null]":e})).sort():["__group"]}),[P,A]);t.useEffect((function(){if(C((function(t){return e.__assign(e.__assign({},t),{groups:H})})),O)return $(!0),function(){return $(!1)}}),[C,H,O]);var J=t.useState(null),K=J[0],Q=J[1],U=t.useState(!1),Z=U[0],$=U[1],ee=t.useState(!1),te=ee[0],re=ee[1],ae=i.useSpring({frame:Z?0:1,config:{duration:1500},delay:200,onRest:function(){re(!0)}});t.useLayoutEffect((function(){if(O){var e=null==j?void 0:j.map((function(e){if(D.filter((function(t){return P(t)===e})).length){var t=document.getElementById("geom-line-"+k+"-"+e);return{group:e,pathLength:null==t?void 0:t.getTotalLength()}}})).filter((function(e){return e}));Q(e),$(!0)}}),[D,F,L]);var ne=(null==I?void 0:I.scale)||a.scaleOrdinal({domain:H,range:(null==I?void 0:I.scheme)||(f?[f]:V.stroke?d:[z])}),le=a.scaleOrdinal({domain:H,range:(null==N?void 0:N.values)||(y?[y]:V.size?o.range(2,10):[2.5])}),ue=a.scaleOrdinal({domain:j,range:null==Y?void 0:Y.values});return c.default.createElement(c.default.Fragment,null,null==j?void 0:j.map((function(e,t){var a,n=D.filter((function(t){return P(t)===e})),l=null===(a=null==K?void 0:K.find((function(t){return t.group===e})))||void 0===a?void 0:a.pathLength;return n.length?c.default.createElement(r.LinePath,{style:{pointerEvents:"none"},key:e+"-line",data:n,curve:E,x:w,y:G,defined:function(e){var t=[void 0,NaN,null];return!t.includes(V.y(e))&&!t.includes(P(e))}},(function(t){var r,a=(0,t.path)(n)||"";return c.default.createElement(c.default.Fragment,null,c.default.createElement("path",{id:"geom-line-"+k+"-"+e,d:a,fill:"none"}),c.default.createElement(i.animated.path,{d:a,fill:"none",stroke:ne(e),strokeOpacity:g,strokeWidth:le(e),strokeDashoffset:O&&ae?null===(r=null==ae?void 0:ae.frame)||void 0===r?void 0:r.interpolate((function(e){return e*(l||0)})):void 0,strokeDasharray:O&&!te?l:"__group"!==e&&(null==Y?void 0:Y.values)?ue(e):v}))})):null})),!b&&D&&V.x&&c.default.createElement(c.default.Fragment,null,c.default.createElement(p,{data:D,group:P,x:w,y:G,b:V.x,markerRadius:x,strokeOpacity:g,thisStrokeScale:ne,thisSizeScale:le,thisDashArrayScale:ue,stroke:f||z}),c.default.createElement(l.EventField,{xScale:F,yScale:L,onMouseOver:R,onMouseOut:T})))};g.displayName="GeomLine",exports.GeomLine=g;
//# sourceMappingURL=index.js.map
