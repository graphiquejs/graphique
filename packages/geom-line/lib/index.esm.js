import{__spreadArrays as e,__assign as t}from"tslib";import r,{useMemo as n,useCallback as o,useEffect as a,useState as i,useLayoutEffect as l}from"react";import{Line as u,LinePath as m}from"@visx/shape";import{scaleOrdinal as c}from"@visx/scale";import"d3-time-format";import{schemeTableau10 as s}from"d3-scale-chromatic";import{TooltipContainer as f,themeState as d,layoutState as p,tooltipState as g,aesState as v,XTooltip as y,YTooltip as h,dataState as k,scalesState as E,EventField as x}from"@graphique/gg";import{useRecoilValue as S,useRecoilState as O}from"recoil";import{bisector as F,mean as _,range as b}from"d3-array";import{useSpring as D,animated as A}from"react-spring";var z=e([s[0],s[1],s[4],s[2],s[3]],s.slice(5)),R=function(e){var t=e.data,n=e.hasXAxisTooltip,o=void 0!==n&&n,a=t[0].formattedX;return t&&r.createElement(f,null,!o&&r.createElement("div",{style:{marginTop:2,marginBottom:1===t.length?2:6,color:"#555"}},a),t.map((function(e,n){return r.createElement("div",{key:"group-tooltip-"+(e.label||e.group)},r.createElement("div",{style:{marginTop:3,marginBottom:t.length<n+1?3:2,display:"flex",alignItems:"center"}},(e.label||"__group"!==e.group)&&r.createElement(r.Fragment,null,e.mark,r.createElement("div",{style:{display:"flex",alignItems:"flex-end",marginLeft:4}},r.createElement("div",{style:{marginRight:5}},r.createElement("span",null,e.label||e.group," ")))),r.createElement("div",{style:{fontWeight:500,fontSize:13}},e.formattedY)))})))},T=function(e){var t=e.left,n=e.y,o=e.markerData,a=e.markerFill,i=e.markerRadius,l=e.strokeOpacity,m=S(d).markerStroke,c=S(p),s=c.height,f=c.margin;return r.createElement(r.Fragment,null,r.createElement("g",null,r.createElement(u,{from:{x:t,y:0},to:{x:t,y:s-f.top-f.bottom},stroke:"#888",strokeWidth:1.5,style:{pointerEvents:"none"},strokeDasharray:"2,2"})),o.map((function(e,u){var c=o.find((function(t){return t.group===e.group})),s=c?n(c):void 0;return e.group&&s?r.createElement("g",{key:"linemarker-"+u},r.createElement("circle",{cx:t,cy:n(c),r:i,fill:a(e.group),fillOpacity:l||.9,stroke:m,strokeOpacity:.92,strokeWidth:i/3.2,style:{pointerEvents:"none"}})):null})))},L=function(e){var o=e.data,a=e.group,i=e.x,l=e.y,m=e.b,c=e.markerRadius,s=e.strokeOpacity,d=e.thisStrokeScale,k=e.thisSizeScale,E=e.thisDashArrayScale,x=e.stroke,O=S(g),b=O.x0,D=O.position,A=O.xAxis,z=O.content,L=O.yFormat,W=O.xFormat,M=S(p),X=M.id,B=M.margin,I=M.height,N=S(v).y,w=F(m).left,Y=n((function(){return w(o,b,1)}),[o,b,w]),q=n((function(){return o[Y-1]}),[o,Y]),G=n((function(){return i(q)}),[i,q]),j=n((function(){return q&&o.filter((function(e){return+i(e)===i(q)})).map((function(e){return t(t({},e),{group:a(e)})}))}),[o,i,q,a]),C=n((function(){return _(j.map(l))||0}),[j,l]),H=n((function(){return m(q)}),[m,q]),J=n((function(){return j.filter((function(e){return N(e)})).map((function(e){var t=r.createElement("svg",{height:8,width:24},r.createElement(u,{from:{x:0,y:4},to:{x:24,y:4},stroke:d(a(e)),strokeWidth:k(a(e)),strokeDasharray:E(a(e))}));return{group:a(e),mark:t,x:H,y:N(e),formattedY:L?L(N(e)):N(e),formattedX:W?W(H):H.toString()}}))}),[j,a,H,N,E,d,k,L,W]);return b?r.createElement(r.Fragment,null,r.createElement(T,{left:G,y:l,markerData:j,markerFill:function(e){return"__group"===e?x:d(e)},markerRadius:c,strokeOpacity:s}),A&&r.createElement(y,{id:X,left:G,top:-B.bottom-5,value:"boolean"==typeof A?r.createElement(f,null,W?W(H):H.toString()):A({x:H})}),j.some(N)&&r.createElement(h,{id:X,left:G,top:"data"===D?-(I-C):-I,value:z?z({data:J}):r.createElement(R,{data:J,hasXAxisTooltip:!!A})})):null},W=function(e){var u=e.data,s=e.stroke,f=e.strokeOpacity,p=void 0===f?1:f,g=e.strokeDashArray,y=e.size,h=e.scales,F=e.id,_=e.curve,R=e.markerRadius,T=void 0===R?5:R,W=e.hideTooltip,M=void 0!==W&&W,X=e.animate,B=void 0!==X&&X,I=e.onMouseOver,N=e.onMouseOut,w=n((function(){return h}),[h]),Y=w.x,q=w.y,G=S(k),j=n((function(){return u||G}),[u,G]),C=S(v),H=S(d).defaultStroke,J=O(E),K=J[0],P=J[1],Q=n((function(){return K}),[K]),U=Q.stroke,V=Q.size,Z=Q.dashArray,$=Q.groups,ee=o((function(e){return Y&&C.x(e)?Y(C.x(e)):0}),[Y,C]),te=o((function(e){return q&&C.y(e)?q(C.y(e)):void 0}),[q,C]),re=n((function(){return C.group||C.stroke||C.size||function(e){return"__group"}}),[C]),ne=n((function(){return re?Array.from(new Set(G.map(re))).map((function(e){return null===e?"[null]":e})).sort():["__group"]}),[re,G]);a((function(){if(P((function(e){return t(t({},e),{groups:ne})})),B)return me(!0),function(){return me(!1)}}),[P,ne,B]);var oe=i(null),ae=oe[0],ie=oe[1],le=i(!1),ue=le[0],me=le[1],ce=i(!1),se=ce[0],fe=ce[1],de=D({frame:ue?0:1,config:{duration:1500},delay:200,onRest:function(){fe(!0)}});l((function(){if(B){var e=null==$?void 0:$.map((function(e){if(j.filter((function(t){return re(t)===e})).length){var t=document.getElementById("geom-line-"+F+"-"+e);return{group:e,pathLength:null==t?void 0:t.getTotalLength()}}})).filter((function(e){return e}));ie(e),me(!0)}}),[j,Y,q]);var pe=(null==U?void 0:U.scale)||c({domain:ne,range:(null==U?void 0:U.scheme)||(s?[s]:C.stroke?z:[H])}),ge=c({domain:ne,range:(null==V?void 0:V.values)||(y?[y]:C.size?b(2,10):[2.5])}),ve=c({domain:$,range:null==Z?void 0:Z.values});return r.createElement(r.Fragment,null,null==$?void 0:$.map((function(e,t){var n,o=j.filter((function(t){return re(t)===e})),a=null===(n=null==ae?void 0:ae.find((function(t){return t.group===e})))||void 0===n?void 0:n.pathLength;return o.length?r.createElement(m,{style:{pointerEvents:"none"},key:e+"-line",data:o,curve:_,x:ee,y:te,defined:function(e){var t=[void 0,NaN,null];return!t.includes(C.y(e))&&!t.includes(re(e))}},(function(t){var n,i=(0,t.path)(o)||"";return r.createElement(r.Fragment,null,r.createElement("path",{id:"geom-line-"+F+"-"+e,d:i,fill:"none"}),r.createElement(A.path,{d:i,fill:"none",stroke:pe(e),strokeOpacity:p,strokeWidth:ge(e),strokeDashoffset:B&&de?null===(n=null==de?void 0:de.frame)||void 0===n?void 0:n.interpolate((function(e){return e*(a||0)})):void 0,strokeDasharray:B&&!se?a:"__group"!==e&&(null==Z?void 0:Z.values)?ve(e):g}))})):null})),!M&&j&&C.x&&r.createElement(r.Fragment,null,r.createElement(L,{data:j,group:re,x:ee,y:te,b:C.x,markerRadius:T,strokeOpacity:p,thisStrokeScale:pe,thisSizeScale:ge,thisDashArrayScale:ve,stroke:s||H}),r.createElement(x,{xScale:Y,yScale:q,onMouseOver:I,onMouseOut:N})))};W.displayName="GeomLine";export{W as GeomLine};
//# sourceMappingURL=index.esm.js.map
